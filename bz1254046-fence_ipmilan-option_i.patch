From ef4648a55c4061d56176037c5d9ad0a8f1af5d72 Mon Sep 17 00:00:00 2001
From: Marek 'marx' Grac <mgrac@redhat.com>
Date: Mon, 17 Aug 2015 09:30:03 +0200
Subject: [PATCH 1/6] fence_ipmilan: Restore deprecated option -i which is
 alias to -a / --ip

Resolves: rhbz#1254046
---
 fence/agents/ipmilan/fence_ipmilan.py | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/fence/agents/ipmilan/fence_ipmilan.py b/fence/agents/ipmilan/fence_ipmilan.py
index 30cfca9..d7c91bf 100644
--- a/fence/agents/ipmilan/fence_ipmilan.py
+++ b/fence/agents/ipmilan/fence_ipmilan.py
@@ -119,12 +119,18 @@ def define_new_opts():
 		"default" : "@IPMITOOL_PATH@",
 		"order": 200
 	}
+	all_opt["obsolete_ip"] = {
+		"getopt" : "i:",
+		"longopt" : "obsolete-ip",
+		"help" : "",
+		"order" : 1
+	}
 
 def main():
 	atexit.register(atexit_handler)
 
 	device_opt = ["ipaddr", "ipport", "login", "no_login", "no_password", "passwd",
-		"lanplus", "auth", "cipher", "privlvl", "sudo", "ipmitool_path", "method"]
+		"lanplus", "auth", "cipher", "privlvl", "sudo", "ipmitool_path", "method", "obsolete_ip"]
 	define_new_opts()
 
 	if os.path.basename(sys.argv[0]) == "fence_ilo3":
@@ -136,7 +142,11 @@ def main():
 
 	all_opt["ipport"]["default"] = "623"
 
-	options = check_input(device_opt, process_input(device_opt))
+	pi = process_input(device_opt)
+	# Accept also deprecated option but do not propagate it at all
+	if "--obsolete-ip" in pi:
+		pi["--ip"] = pi["--obsolete-ip"]
+	options = check_input(device_opt, pi)
 
 	docs = {}
 	docs["shortdesc"] = "Fence agent for IPMI"
-- 
1.9.3

